{"version":3,"file":"polls-block/view.js","mappings":"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","sources":["webpack://polls-block/external module \"@wordpress/interactivity\"","webpack://polls-block/webpack/bootstrap","webpack://polls-block/webpack/runtime/make namespace object","webpack://polls-block/./src/polls-block/view.js"],"sourcesContent":["module.exports = __WEBPACK_EXTERNAL_MODULE__wordpress_interactivity_8e89b257__;","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","import { store, getContext } from '@wordpress/interactivity';\n\nconst { state } = store( 'buntywp-polls', {\n\tstate: {\n\t\tget totalVoteCount() {\n\t\t\tconst context = getContext();\n\t\t\treturn context.totalVotes;\n\t\t},\n\t\tget userVoted() {\n\t\t\tconst context = getContext();\n\t\t\treturn context.userVoted;\n\t\t},\n\t\tget userSelection() {\n\t\t\tconst context = getContext();\n\t\t\tconst selected = parseInt(context.userSelection);\n\t\t\tconst current = parseInt(context.options[context.item.id].id);\n\t\t\treturn ( selected === current ) ? true : false;\n\t\t},\n\t\tget isPollOpen() {\n\t\t\tconst context = getContext();\n\t\t\treturn context.isPollOpen;\n\t\t},\n\t},\n\tactions: {\n\t\ttoggleVote: () => {\n\t\t\tconst context = getContext();\n\n\t\t\t// Return if poll is closed or already voted\n\t\t\tif ( !context.isPollOpen || context.userVoted ) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tlet index = context.item.id;\n\t\t\tcontext.options[ index ].votes =\n\t\t\t\t( context.options[ index ].votes || 0 ) + 1;\n\t\t\tcontext.userSelection = context.options[index].id;\n\t\t\tcontext.options = context.options;\n\t\t\tcontext.totalVotes = Number( context.totalVotes + 1 );\n\t\t\tcontext.userVoted = true;\n\t\t\tsaveVoteToServer( context );\n\t\t},\n\t\tgetPercentage: () => {\n\t\t\tconst context = getContext();\n\t\t\tif ( context.totalVotes === 0 ) {\n\t\t\t\treturn '0%';\n\t\t\t}\n\t\t\tlet index = context.item.id;\n\t\t\tconst percentage =\n\t\t\t\t( context.options[ index ].votes / context.totalVotes ) * 100;\n\t\t\treturn `${ percentage.toFixed( 0 ) }%`;\n\t\t},\n\t\tinitUserVoteState: () => {\n\t\t\tconst context = getContext();\n\t\t\tconst key_voted = `poll_voted_${context.blockId}`;\n\t\t\tconst key_selection = `poll_selection_${context.blockId}`;\n\t\t\tif (localStorage.getItem(key_voted) === '1') {\n\t\t\t\tcontext.userVoted = true;\n\t\t\t\tcontext.userSelection = parseInt(localStorage.getItem(key_selection));\n\t\t\t\tlocalStorage.removeItem(key_voted);\n\t\t\t\tlocalStorage.removeItem(key_selection);\n\t\t\t}\n\t\t},\n\t},\n\tcallbacks: {\n\t\tlogIsPollOpen: () => {\n\t\t\tconst { isOpen } = getContext();\n\t\t},\n\t},\n} );\n\n/**\n * Save the vote to the server via AJAX.\n *\n * @param {object} context Poll Context.\n */\nfunction saveVoteToServer( context ) {\n\tfetch( state.ajaxUrl, {\n\t\tmethod: 'POST',\n\t\theaders: {\n\t\t\t'Content-Type': 'application/x-www-form-urlencoded',\n\t\t},\n\t\tbody: new URLSearchParams( {\n\t\t\taction: 'save_poll_vote',\n\t\t\tnonce: state.nonce,\n\t\t\tcontext: JSON.stringify( context ),\n\t\t} ),\n\t} )\n\t\t.then( ( response ) => response.json() )\n\t\t.then( ( data ) => {\n\t\t\tconsole.log( 'Vote saved:', data );\n\n\t\t\tif (context.showResultsInNewPage) {\n\t\t\t\tlocalStorage.setItem(`poll_voted_${context.blockId}`, '1');\n\t\t\t\tlocalStorage.setItem(`poll_selection_${context.blockId}`, context.userSelection);\n\t\t\t\twindow.location.reload();\n\t\t\t}\n\t\t} )\n\t\t.catch( ( error ) => {\n\t\t\tconsole.error( 'Error saving vote:', error );\n\t\t} );\n}\n"],"names":["store","getContext","state","totalVoteCount","context","totalVotes","userVoted","userSelection","selected","parseInt","current","options","item","id","isPollOpen","actions","toggleVote","index","votes","Number","saveVoteToServer","getPercentage","percentage","toFixed","initUserVoteState","key_voted","blockId","key_selection","localStorage","getItem","removeItem","callbacks","logIsPollOpen","isOpen","fetch","ajaxUrl","method","headers","body","URLSearchParams","action","nonce","JSON","stringify","then","response","json","data","console","log","showResultsInNewPage","setItem","window","location","reload","catch","error"],"sourceRoot":""}