import*as t from"@wordpress/interactivity";var e={d:(t,o)=>{for(var n in o)e.o(o,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:o[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)};const o=(r={getContext:()=>t.getContext,store:()=>t.store},s={},e.d(s,r),s),{state:n}=(0,o.store)("buntywp-polls",{state:{get totalVoteCount(){return(0,o.getContext)().totalVotes},get userVoted(){return(0,o.getContext)().userVoted},get userSelection(){const t=(0,o.getContext)();return parseInt(t.userSelection)===parseInt(t.options[t.item.id].id)},get isPollOpen(){return(0,o.getContext)().isPollOpen}},actions:{toggleVote:()=>{const t=(0,o.getContext)();if(!t.isPollOpen||t.userVoted)return;let e=t.item.id;t.options[e].votes=(t.options[e].votes||0)+1,t.userSelection=t.options[e].id,t.options=t.options,t.totalVotes=Number(t.totalVotes+1),t.userVoted=!0,function(t){fetch(n.ajaxUrl,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({action:"save_poll_vote",nonce:n.nonce,context:JSON.stringify(t)})}).then((t=>t.json())).then((e=>{console.log("Vote saved:",e),t.showResultsInNewPage&&(localStorage.setItem(`poll_voted_${t.blockId}`,"1"),localStorage.setItem(`poll_selection_${t.blockId}`,t.userSelection),window.location.reload())})).catch((t=>{console.error("Error saving vote:",t)}))}(t)},getPercentage:()=>{const t=(0,o.getContext)();if(0===t.totalVotes)return"0%";let e=t.item.id;return`${(t.options[e].votes/t.totalVotes*100).toFixed(0)}%`},initUserVoteState:()=>{const t=(0,o.getContext)(),e=`poll_voted_${t.blockId}`,n=`poll_selection_${t.blockId}`;"1"===localStorage.getItem(e)&&(t.userVoted=!0,t.userSelection=parseInt(localStorage.getItem(n)),localStorage.removeItem(e),localStorage.removeItem(n))}},callbacks:{logIsPollOpen:()=>{const{isOpen:t}=(0,o.getContext)()}}});var r,s;